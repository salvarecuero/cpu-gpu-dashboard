[Rainmeter]
Update=1000
AccurateText=1
DynamicWindowSize=1

[Metadata]
Name=CPU/GPU Dashboard
Author=CPU GPU Dashboard
Version=1.0.0
Information=Displays CPU and GPU temperature and usage from HWiNFO64

; ==========================================
; INCLUDES
; ==========================================
@IncludeVariables=#@#Variables.inc
@IncludeStyles=#@#Styles.inc

; ==========================================
; MEASURES - CONFIGURATION CHECK
; ==========================================

[MeasureCheckConfig]
Measure=Calc
Formula=#IsConfigured#
IfCondition=(MeasureCheckConfig = 0)
IfTrueAction=[!ActivateConfig "CPUGPUDashboard\Setup" "Setup.ini"][!DeactivateConfig "#CURRENTCONFIG#"]
DynamicVariables=1

; ==========================================
; MEASURES - CPU DATA
; ==========================================

[MeasureCPUTemp]
Measure=Registry
RegHKey=#RegHKey#
RegKey=SOFTWARE\HWiNFO64\VSB
RegValue=ValueRaw#CPUTempIndex#
IfMatch=^$
IfMatchAction=[!ShowMeterGroup ErrorGroup][!HideMeterGroup DashboardGroup][!Redraw]
IfNotMatchAction=[!HideMeterGroup ErrorGroup][!ShowMeterGroup DashboardGroup][!Redraw]
DynamicVariables=1

[MeasureCPUUsage]
Measure=Registry
RegHKey=#RegHKey#
RegKey=SOFTWARE\HWiNFO64\VSB
RegValue=ValueRaw#CPUUsageIndex#
DynamicVariables=1

; ==========================================
; MEASURES - GPU DATA
; ==========================================

[MeasureGPUTemp]
Measure=Registry
RegHKey=#RegHKey#
RegKey=SOFTWARE\HWiNFO64\VSB
RegValue=ValueRaw#GPUTempIndex#
DynamicVariables=1

[MeasureGPUUsage]
Measure=Registry
RegHKey=#RegHKey#
RegKey=SOFTWARE\HWiNFO64\VSB
RegValue=ValueRaw#GPUUsageIndex#
DynamicVariables=1

; ==========================================
; MEASURES - COLOR CALCULATION
; ==========================================

[MeasureMaxTemp]
Measure=Calc
Formula=Max(MeasureCPUTemp, MeasureGPUTemp)
DynamicVariables=1

; ==========================================
; METERS - BACKGROUND
; ==========================================

[MeterBackground]
Meter=Shape
Shape=Rectangle 0,0,#SkinWidth#,#SkinHeight#,#CornerRadius# | Fill Color #ColorBackground# | StrokeWidth 0
Group=DashboardGroup

; Temperature-based color overlay
; Green (0-40C) -> Yellow (40-70C) -> Red (70-100C)
[MeterTempOverlay]
Meter=Shape
Shape=Rectangle 0,0,#SkinWidth#,#SkinHeight#,#CornerRadius# | Fill Color (Clamp(([MeasureMaxTemp]-20)*8,0,255)),(Clamp(255-([MeasureMaxTemp]-50)*5,0,255)),0,30 | StrokeWidth 0
DynamicVariables=1
Group=DashboardGroup

; ==========================================
; METERS - CPU SECTION
; ==========================================

[MeterCPUIcon]
Meter=String
X=#Padding#
Y=#Padding#
FontFace=Segoe UI
FontSize=18
FontColor=#ColorText#
AntiAlias=1
Text=CPU
Group=DashboardGroup

[MeterCPUTemp]
Meter=String
MeterStyle=StyleValue
MeasureName=MeasureCPUTemp
X=#Padding#
Y=5R
Text=%1
NumOfDecimals=0
Group=DashboardGroup

[MeterCPUTempUnit]
Meter=String
MeterStyle=StyleUnit
X=2R
Y=5r
Text=C
Group=DashboardGroup

[MeterCPUUsage]
Meter=String
MeterStyle=StyleValueSmall
MeasureName=MeasureCPUUsage
X=(#SkinWidth#/2 + 10)
Y=([MeterCPUTemp:Y])
Text=%1%
NumOfDecimals=0
DynamicVariables=1
Group=DashboardGroup

[MeterCPUUsageLabel]
Meter=String
MeterStyle=StyleUnit
X=0r
Y=2R
Text=usage
Group=DashboardGroup

; ==========================================
; METERS - GPU SECTION
; ==========================================

[MeterGPUIcon]
Meter=String
X=#Padding#
Y=([MeterCPUTemp:Y] + 45)
FontFace=Segoe UI
FontSize=18
FontColor=#ColorText#
AntiAlias=1
Text=GPU
DynamicVariables=1
Group=DashboardGroup

[MeterGPUTemp]
Meter=String
MeterStyle=StyleValue
MeasureName=MeasureGPUTemp
X=#Padding#
Y=5R
Text=%1
NumOfDecimals=0
Group=DashboardGroup

[MeterGPUTempUnit]
Meter=String
MeterStyle=StyleUnit
X=2R
Y=5r
Text=C
Group=DashboardGroup

[MeterGPUUsage]
Meter=String
MeterStyle=StyleValueSmall
MeasureName=MeasureGPUUsage
X=(#SkinWidth#/2 + 10)
Y=([MeterGPUTemp:Y])
Text=%1%
NumOfDecimals=0
DynamicVariables=1
Group=DashboardGroup

[MeterGPUUsageLabel]
Meter=String
MeterStyle=StyleUnit
X=0r
Y=2R
Text=usage
Group=DashboardGroup

; ==========================================
; METERS - SETTINGS BUTTON
; ==========================================

[MeterSettingsButton]
Meter=String
MeterStyle=StyleButton
X=(#SkinWidth# - #Padding# - 60)
Y=#Padding#
Text=Setup
LeftMouseUpAction=[!WriteKeyValue Variables IsConfigured "0" "#@#Variables.inc"][!ActivateConfig "CPUGPUDashboard\Setup" "Setup.ini"][!DeactivateConfig "#CURRENTCONFIG#"]
Group=DashboardGroup

; ==========================================
; METERS - ERROR GROUP
; ==========================================

[MeterErrorBackground]
Meter=Shape
Shape=Rectangle 0,0,#SkinWidth#,#SkinHeight#,#CornerRadius# | Fill Color #ColorBackground# | StrokeWidth 0
Group=ErrorGroup
Hidden=1

[MeterErrorTitle]
Meter=String
MeterStyle=StyleTitle
X=(#SkinWidth#/2)
Y=25
StringAlign=Center
Text=Sensor Error
FontColor=#ColorDanger#
Group=ErrorGroup
Hidden=1

[MeterErrorText]
Meter=String
MeterStyle=StyleInstructions
X=(#SkinWidth#/2)
Y=10R
W=(#SkinWidth# - 40)
StringAlign=Center
Text=HWiNFO64 sensors not found. Ensure HWiNFO is running with Gadget reporting enabled.
Group=ErrorGroup
Hidden=1

[MeterReconfigureButton]
Meter=String
MeterStyle=StyleButtonPrimary
X=(#SkinWidth#/2 - 50)
Y=20R
Text=Reconfigure
LeftMouseUpAction=[!WriteKeyValue Variables IsConfigured "0" "#@#Variables.inc"][!ActivateConfig "CPUGPUDashboard\Setup" "Setup.ini"][!DeactivateConfig "#CURRENTCONFIG#"]
Group=ErrorGroup
Hidden=1
